(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{K7In:function(t,e,n){"use strict";n.r(e),n.d(e,"MessagesModule",function(){return P});var s=n("ofXK"),o=n("fXoL"),i=n("WBZy"),a=n("tyNb"),c=n("YTKZ"),r=n("3Pt+"),d=n("1kSV"),l=n("cZdB");const g=["scrollMe"];function p(t,e){if(1&t&&(o.ac(0,"h6",23),o.Kc(1),o.Zb()),2&t){const t=o.mc(2);o.Jb(1),o.Nc("",t.userRoom.user.firstName," ",t.userRoom.user.lastName,"")}}function u(t,e){if(1&t){const t=o.bc();o.ac(0,"div",15),o.Ic(1,p,2,2,"h6",16),o.ac(2,"div",17),o.ac(3,"div",18),o.ac(4,"button",19),o.Wb(5,"i",20),o.Zb(),o.ac(6,"div",21),o.ac(7,"button",22),o.kc("click",function(){o.Dc(t);const e=o.mc();return e.deleteRoom(e.userRoom.id)}),o.Kc(8,"Delete"),o.Zb(),o.Zb(),o.Zb(),o.Zb(),o.Zb()}if(2&t){const t=o.mc();o.Jb(1),o.tc("ngIf",null!=t.userRoom.user)}}function h(t,e){if(1&t&&(o.ac(0,"div"),o.ac(1,"div",48),o.ac(2,"a",49),o.Kc(3),o.ac(4,"small",50),o.Kc(5),o.nc(6,"date"),o.Zb(),o.Zb(),o.Zb(),o.Zb()),2&t){const t=o.mc().$implicit;o.Jb(3),o.Mc(" ",t.Body," "),o.Jb(2),o.Lc(o.pc(6,2,t.sentAt.toDate(),"medium"))}}function b(t,e){if(1&t&&(o.ac(0,"div"),o.ac(1,"div",51),o.ac(2,"a",52),o.Kc(3),o.ac(4,"small",50),o.Kc(5),o.nc(6,"date"),o.Zb(),o.Zb(),o.Zb(),o.Zb()),2&t){const t=o.mc().$implicit;o.Jb(3),o.Mc(" ",t.Body," "),o.Jb(2),o.Lc(o.pc(6,2,t.sentAt.toDate(),"medium"))}}function m(t,e){if(1&t&&(o.ac(0,"div"),o.Ic(1,h,7,5,"div",40),o.Ic(2,b,7,5,"div",40),o.Zb()),2&t){const t=e.$implicit,n=o.mc(3);o.Jb(1),o.tc("ngIf",t.sendBy==n.userID),o.Jb(1),o.tc("ngIf",t.sendBy!=n.userID)}}const f=function(t){return{"text-right":t}};function M(t,e){if(1&t&&(o.ac(0,"div"),o.ac(1,"div",53),o.ac(2,"ngb-alert",54),o.ac(3,"p",55),o.Kc(4,"There is no Masseges yet "),o.Zb(),o.Wb(5,"img",56),o.Zb(),o.Zb(),o.Zb()),2&t){const t=o.mc(3);o.Jb(1),o.tc("ngClass",o.yc(1,f,"ar"==t.Lang))}}function v(t,e){if(1&t){const t=o.bc();o.ac(0,"div",32),o.ac(1,"div",33),o.ac(2,"div",34),o.ac(3,"div",35),o.ac(4,"div",36),o.ac(5,"div",37,38),o.Ic(7,m,3,2,"div",39),o.Ic(8,M,6,3,"div",40),o.Zb(),o.Zb(),o.Zb(),o.ac(9,"div",41),o.ac(10,"form",42),o.kc("ngSubmit",function(){return o.Dc(t),o.mc(2).sendMsg()}),o.ac(11,"div",43),o.ac(12,"div",44),o.Wb(13,"input",45),o.Zb(),o.ac(14,"div",46),o.ac(15,"button",47),o.Kc(16,"Send"),o.Zb(),o.Zb(),o.Zb(),o.Zb(),o.Zb(),o.Zb(),o.Zb(),o.Zb()}if(2&t){const t=o.mc(2);o.Jb(7),o.tc("ngForOf",t.allMsgs),o.Jb(1),o.tc("ngIf",0==t.allMsgs.length),o.Jb(2),o.tc("formGroup",t.msgGroup)}}function C(t,e){if(1&t){const t=o.bc();o.ac(0,"li",24),o.ac(1,"a",25),o.ac(2,"a",26),o.kc("click",function(){o.Dc(t);const n=e.$implicit;return o.mc().getMassege(n.id)}),o.ac(3,"div",27),o.ac(4,"div",28),o.Wb(5,"img",29),o.Zb(),o.ac(6,"div",30),o.ac(7,"h5"),o.Kc(8),o.Zb(),o.Zb(),o.Zb(),o.Zb(),o.Zb(),o.Ic(9,v,17,3,"ng-template",31),o.Zb()}if(2&t){const t=e.$implicit;o.uc("ngbNavItem",t.id),o.Jb(2),o.vc("routerLink","/Messages/all-messages/",t.id,""),o.Jb(3),o.uc("src",t.user.avatar,o.Ec),o.Jb(3),o.Nc("",t.user.firstName," ",t.user.lastName,"")}}let y=(()=>{class t{constructor(t,e,n,s,o,i){this.chat=t,this.route=e,this.router=n,this.us=s,this.fb=o,this.alertConfig=i,this.chatList=[],this.users=[],this.allMsgs=[],this.subscription=[],this.data=this.us.localUserData.asObservable();let a=this.data.subscribe(t=>{null!=t&&(this.userID=t.id,this.loggedUser=t)});this.subscription.push(a),this.msgGroup=this.fb.group({sendBy:this.userID,Body:""}),i.type="white",i.dismissible=!1}ngAfterViewChecked(){this.scrollMeBottom()}ngOnDestroy(){for(var t of this.subscription)t.unsubscribe()}ngOnInit(){let t=this.route.paramMap.subscribe(t=>{this.chatRoom=t.get("id"),null!=this.chatRoom&&this.getMassege(this.chatRoom),this.active=this.chatRoom});this.subscription.push(t);let e=this.chat.getChats().subscribe(t=>{this.chatList=t.map(t=>Object.assign({id:t.payload.doc.id},t.payload.doc.data())),this.users=[],this.chatList.filter(t=>{t.User1.id!=this.userID&&t.User2.id!=this.userID||(t.User1.id!=this.userID||t.User1.isDeleted?t.User2.id!=this.userID||t.User2.isDeleted||(t.id==this.chatRoom&&(this.userRoom={id:t.id,user:t.User1}),this.users.push({id:t.id,user:t.User1})):(t.id==this.chatRoom&&(this.userRoom={id:t.id,user:t.User2}),this.users.push({id:t.id,user:t.User2})))})});this.subscription.push(e),this.msgGroup=this.fb.group({sendBy:this.userID,Body:""}),this.scrollMeBottom()}scrollMeBottom(){try{this.myScrollContainer.nativeElement.scrollTop=this.myScrollContainer.nativeElement.scrollHeight}catch(t){}}getMassege(t){this.userRoom=this.users.find(e=>{if(e.id==t)return e.user}),this.chat.getMasseges(t).subscribe(t=>{this.allMsgs=t.map(t=>Object.assign({id:t.payload.doc.id},t.payload.doc.data()))})}sendMsg(){this.chat.sendMsg(this.chatRoom,this.msgGroup.value.sendBy,this.msgGroup.value.Body),this.msgGroup=this.fb.group({sendBy:this.userID,Body:""})}deleteRoom(t){this.userRoom="",this.chat.deleteRoom(t,this.userID)}}return t.\u0275fac=function(e){return new(e||t)(o.Vb(i.a),o.Vb(a.a),o.Vb(a.f),o.Vb(c.a),o.Vb(r.b),o.Vb(d.c))},t.\u0275cmp=o.Pb({type:t,selectors:[["app-all-messages"]],viewQuery:function(t,e){if(1&t&&o.Oc(g,1),2&t){let t;o.Bc(t=o.lc())&&(e.myScrollContainer=t.first)}},decls:17,vars:8,consts:[[1,"groups-page","container"],[1,"content-groups","py-0","pr-1"],[1,"row","border-bottom"],[1,"col-4","pt-2","border-right"],[1,"text-secondary","custom-header"],["class","col-8 masseges-head-user",4,"ngIf"],[1,"container","pr-0","custom-list"],[1,"d-flex","justify-content-center",2,"height","74vh"],["ngbNav","","orientation","vertical",1,"nav-pills","users-list",2,"flex-flow","column","overflow-y","auto",3,"activeId","activeIdChange"],["nav","ngbNav"],[1,"pt-2","px-1","form-group","has-search"],[1,"fa","fa-search","form-control-feedback"],["type","text","placeholder","Search messages",1,"form-control",3,"ngModel","ngModelChange"],[3,"ngbNavItem",4,"ngFor","ngForOf"],[1,"ml-4",3,"ngbNavOutlet"],[1,"col-8","masseges-head-user"],["class","text-secondary mx-1 my-2",4,"ngIf"],[1,"messages-control"],["ngbDropdown","","container","body",1,"mr-4"],["type","button","ngbDropdownToggle","",1,"btn","btn-default","mt-2","px-3"],[1,"fas","fa-ellipsis-h"],["ngbDropdownMenu",""],["ngbDropdownItem","",3,"click"],[1,"text-secondary","mx-1","my-2"],[3,"ngbNavItem"],["ngbNavLink",""],[1,"list-group-item","list-group-item-action",3,"routerLink","click"],[1,"row"],[1,"col-md-3","px-0","pt-1"],["alt","","srcset","",1,"w-100","rounded-circle",3,"src"],[1,"col-md-9","px-2","py-4","custom-users-name"],["ngbNavContent",""],[1,"chatting-room"],[1,"row","m-0","p-0","position-relative"],[1,"col-12","p-0","m-0","position-absolute",2,"right","0px"],[1,"card","border-0","rounded",2,"box-shadow","0 2px 4px 0 rgba(0, 0, 0, 0.10), 0 6px 10px 0 rgba(0, 0, 0, 0.01)"],[1,"card","border-0","m-0","p-0"],["id","sohbet",1,"card","border-0","m-0","p-0","position-relative",2,"overflow-y","auto","height","70vh","min-height","70vh"],["scrollMe",""],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"w-100","card-footer","p-0","bg-light","border","border-bottom-0","border-left-0","border-right-0"],[1,"m-0","p-0",3,"formGroup","ngSubmit"],[1,"row","m-0","p-0"],[1,"col-9","m-0","p-1"],["id","text","formControlName","Body","type","text","name","Body","title","Type a message...","placeholder","Type a message...","required","",1,"mw-100","border","rounded","form-control"],[1,"col-3","m-0","p-1"],["type","submit",1,"btn","btn-outline-primary","rounded","border","w-100","pr-2"],[1,"sender","p-2","py-3","m-0","position-relative"],[1,"float-right","mb-1"],[1,"pt-1"],[1,"reciever","p-3","m-0","position-relative"],[1,"float-left","sohbet2","mb-1"],[1,"p-2",3,"ngClass"],[1,"text-center"],[2,"font-weight","bold"],["src","../../../../assets/msgs.jpg","alt","","srcset","",1,"img-responsive","img-fluid"]],template:function(t,e){if(1&t&&(o.ac(0,"section",0),o.ac(1,"div",1),o.ac(2,"div",2),o.ac(3,"div",3),o.ac(4,"h5",4),o.Kc(5,"Messaging"),o.Zb(),o.Zb(),o.Ic(6,u,9,1,"div",5),o.Zb(),o.ac(7,"div",6),o.ac(8,"div",7),o.ac(9,"ul",8,9),o.kc("activeIdChange",function(t){return e.active=t}),o.ac(11,"div",10),o.Wb(12,"span",11),o.ac(13,"input",12),o.kc("ngModelChange",function(t){return e.searchKeyWord=t}),o.Zb(),o.Zb(),o.Ic(14,C,10,5,"li",13),o.nc(15,"filter"),o.Zb(),o.Wb(16,"div",14),o.Zb(),o.Zb(),o.Zb(),o.Zb()),2&t){const t=o.Cc(10);o.Jb(6),o.tc("ngIf",null!=e.userRoom),o.Jb(3),o.tc("activeId",e.active),o.Jb(4),o.tc("ngModel",e.searchKeyWord),o.Jb(1),o.tc("ngForOf",o.pc(15,5,e.users,e.searchKeyWord)),o.Jb(2),o.tc("ngbNavOutlet",t)}},directives:[s.n,d.l,r.a,r.k,r.n,s.m,d.p,d.e,d.h,d.g,d.f,d.n,d.o,a.i,d.m,r.t,r.l,r.e,r.d,r.q,s.l,d.b],pipes:[l.a,s.e],styles:["section.groups-page[_ngcontent-%COMP%]   .content-groups[_ngcontent-%COMP%]{border:1px solid;background-color:#fff;border-radius:10px;padding:20px;margin-top:50px;height:82vh}section.groups-page[_ngcontent-%COMP%]   .content-groups[_ngcontent-%COMP%]   .group-tabs[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:not(:last-child){border:none;transition:.3s}section.groups-page[_ngcontent-%COMP%]   .content-groups[_ngcontent-%COMP%]   .group-tabs[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:not(:last-child):hover{background-color:#eee}section.groups-page[_ngcontent-%COMP%]   .content-groups[_ngcontent-%COMP%]   .head-groups-page[_ngcontent-%COMP%]   .group-tabs[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{border-bottom:2px solid #7dc0ff;font-weight:700}section.groups-page[_ngcontent-%COMP%]   .content-groups[_ngcontent-%COMP%]   .Groups-content-display2[_ngcontent-%COMP%]{padding:6px 12px}.custom-left-side-group[_ngcontent-%COMP%]{position:relative}.custom-left-side-group[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{position:absolute;top:60px}.content-groups[_ngcontent-%COMP%]   .Groups-content-display1[_ngcontent-%COMP%]   .list-group-item[_ngcontent-%COMP%], .content-groups[_ngcontent-%COMP%]   .Groups-content-display2[_ngcontent-%COMP%]   .list-group-item[_ngcontent-%COMP%]{padding:.75rem .25rem}.masseges-head-user[_ngcontent-%COMP%]{position:relative}.masseges-head-user[_ngcontent-%COMP%]   .messages-control[_ngcontent-%COMP%]{position:absolute;top:0;right:0}@media screen and (max-width:450px){.custom-users-name[_ngcontent-%COMP%]{display:none}.custom-list[_ngcontent-%COMP%]{padding-left:0}.custom-header[_ngcontent-%COMP%]{font-size:14px}#sohbet[_ngcontent-%COMP%]{height:66vh!important;min-height:66vh!important}.has-search[_ngcontent-%COMP%]   .form-control-feedback[_ngcontent-%COMP%]{display:none!important}.has-search[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{padding-left:.375rem!important}}@media screen and (max-width:1024px){#sohbet[_ngcontent-%COMP%]{height:65vh!important;min-height:65vh!important}}.has-search[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{padding-left:2.375rem}.has-search[_ngcontent-%COMP%]   .form-control-feedback[_ngcontent-%COMP%]{position:absolute;z-index:2;display:block;width:2.375rem;height:2.375rem;line-height:2.375rem;text-align:center;pointer-events:none;color:#aaa}.nav-pills[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%], .nav-pills[_ngcontent-%COMP%]   .show[_ngcontent-%COMP%] > .nav-link[_ngcontent-%COMP%]{padding:4px;background-color:#aed3f8}.list-group-item[_ngcontent-%COMP%]{background-color:#aed3f800;border:none;padding-top:0;padding-bottom:0}.reciever[_ngcontent-%COMP%], .sender[_ngcontent-%COMP%]{margin-top:5px!important;margin-bottom:5px!important}.sender[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{background:#42a5f5;color:#fff!important;border-radius:20px 20px 3px 20px;display:block;max-width:75%;padding:7px 13px;text-decoration:none;text-align:right}.sender[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:block;font-size:.7rem;color:#ddd;font-weight:700}.reciever[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{background:#f1f1f1;color:#000!important;border-radius:20px 20px 20px 3px;display:block;max-width:75%;padding:7px 13px;text-decoration:none}.reciever[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:block;font-size:.7rem;color:#a4bac4;font-weight:700}.dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.btn[_ngcontent-%COMP%]:focus{outline:none;box-shadow:none}.users-list[_ngcontent-%COMP%]{max-width:30%;min-width:30%}.chatting-room[_ngcontent-%COMP%]{min-width:100%;max-width:100%}.tab-content[_ngcontent-%COMP%]{width:100%!important}"]}),t})();const O=[{path:"all-messages",component:y},{path:"all-messages/:id",component:y},{path:"",redirectTo:"/Messages/all-messages",pathMatch:"full"},{path:"**",redirectTo:"/Messages",pathMatch:"full"}];let P=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.Tb({type:t}),t.\u0275inj=o.Sb({imports:[[s.c,a.j.forChild(O),d.k,r.p,r.f,l.b]]}),t})()},WBZy:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var s=n("fXoL"),o=n("I/3d"),i=n("tyNb");let a=(()=>{class t{constructor(t,e){this.db=t,this.router=e}getChats(){return this.db.collection("Masseges").snapshotChanges()}getMasseges(t){return this.db.collection("Masseges").doc(t).collection("masseges",t=>t.limit(20).orderBy("sentAt","asc")).snapshotChanges()}getRoom(t){return this.db.collection("Masseges").doc(t).snapshotChanges()}fullDeleteRoom(t){return this.db.collection("Masseges").doc(t).delete()}filtration(t,e,n){return t.filter(t=>{let s=t.User1,o=t.User2;if(s.id==e&&o.id==n||s.id==n&&o.id==e)return t})}newChat(t,e){let n=[],s=this.getChats().subscribe(o=>{if(n=o.map(t=>Object.assign({id:t.payload.doc.id},t.payload.doc.data())),n=this.filtration(n,t.id,e.id),s.unsubscribe(),!(n.length>0))return this.db.collection("Masseges").add({User1:{firstName:t.firstName,lastName:t.lastName,avatar:t.avatar,isDeleted:!1,id:t.id},User2:{firstName:e.firstName,lastName:e.lastName,avatar:e.avatar,isDeleted:!1,id:e.id}}).then(t=>{this.router.navigate([`/Messages/all-messages/${t.id}`])});{let e=n[0].id;if(t.id==n[0].User1.id)return this.db.collection("Masseges").doc(e).update({User1:{firstName:t.firstName,lastName:t.lastName,avatar:t.avatar,isDeleted:!1,id:t.id}}).then(t=>{this.router.navigate([`/Messages/all-messages/${e}`])});if(t.id==n[0].User2.id)return this.db.collection("Masseges").doc(e).update({User2:{firstName:t.firstName,lastName:t.lastName,avatar:t.avatar,isDeleted:!1,id:t.id}}).then(t=>{this.router.navigate([`/Messages/all-messages/${e}`])})}})}sendMsg(t,e,n){return this.db.collection("Masseges").doc(t).collection("masseges").add({sendBy:e,Body:n,sentAt:new Date})}deleteRoom(t,e){let n,s,o,i,a=this.getRoom(t).subscribe(c=>{if(n=c.payload.data().User1,s=c.payload.data().User2,o=c.payload.data().User1.isDeleted,i=c.payload.data().User2.isDeleted,a.unsubscribe(),n.id==e&&i||s.id==e&&o)this.fullDeleteRoom(t);else{if(n.id==e&&!i)return n.isDeleted=!0,this.db.collection("Masseges").doc(t).update({User1:n});if(s.id==e&&!o)return s.isDeleted=!0,this.db.collection("Masseges").doc(t).update({User2:s})}})}}return t.\u0275fac=function(e){return new(e||t)(s.hc(o.a),s.hc(i.f))},t.\u0275prov=s.Rb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);